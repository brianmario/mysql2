sudo: required
language: ruby
bundler_args: --without benchmarks
addons:
  homebrew:
    packages:
      - mysql
script:
  - bundle exec rake spec
before_install:
  - gem --version
  - |
    bash -c " # Install MySQL if DB=mysql*
    if [[ x$DB =~ xmysql ]]; then
      sudo bash .travis_mysql.sh '$DB'
    fi
    "
  - |
    bash -c " # Install MariaDB if DB=mariadb*
    if [[ x$DB =~ xmariadb ]]; then
      sudo bash .travis_mariadb.sh '$DB'
    fi
    "
  - |
    bash -c " # Install MySQL if OS=darwin
    if [[ x$OSTYPE =~ ^xdarwin ]]; then
      # Disable SSL due to missing certs
      echo ssl = 0 >> /usr/local/etc/my.cnf
      mysql.server start
    fi
    "
  - |
    bash -c " # Configure SSL support
    if [[ ! x$OSTYPE =~ ^xdarwin ]]; then
      sudo bash .travis_ssl.sh
      sudo service mysql restart
    fi
    "
  - mysqld --version
  - mysql -u root -e "CREATE DATABASE IF NOT EXISTS test"
  - mysql -u root -e "CREATE USER '$USER'@'localhost'" || true
os: linux
dist: trusty
rvm:
  - 1.8.7
  - 1.9.3
  - 2.0.0
  - 2.1
  - 2.2
  - 2.3
  - ree
matrix:
  fast_finish: true
  allow_failures:
    - os: osx
    - rvm: ree
  include:
    - rvm: 2.0.0
      env: DB=mariadb55
    - rvm: 2.0.0
      env: DB=mariadb10
    - rvm: 2.0.0
      env: DB=mysql55
    - rvm: 2.0.0
      env: DB=mysql57
    - rvm: 2.0.0
      dist: xenial
      env: DB=mysql8
    - rvm: 2.3
      os: osx
